<div class="min-h-screen bg-slate-50">
  <!-- Header -->

  <div class="container mx-auto px-4 py-8 max-w-6xl">
    <!-- Repository Header -->
    <div class="mb-8">
      <div class="flex items-start justify-between mb-4">
        <div class="flex items-center gap-4">
          <div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center text-xl font-semibold text-gray-600">
            <%= @repository.owner.first.upcase %>
          </div>
          <div>
            <h1 class="text-3xl font-bold flex items-center gap-3">
              <i class="fa-regular fa-heart text-red"></i>
              <%= @repository.owner %>/<%= @repository.name %>
              <span class="px-2 py-1 text-xs font-medium rounded-full>">
                <%= @repository.status %>
              </span>
            </h1>
            <p class="text-lg text-slate-600 mt-2"><%= @repository.description %></p>
          </div>
        </div>
      </div>

      <!-- Stats -->
      <div class="grid grid-cols-2 md:grid-cols-6 gap-4 mb-6">
        <div class="bg-white rounded-lg border p-4 text-center">
          <div class="flex items-center justify-center gap-1 text-lg font-semibold">
            <i class="fa-regular fa-heart text-red"></i>
            <%= @repository.stars_count %>
          </div>
          <p class="text-sm text-slate-600">Stars</p>
        </div>
        <div class="bg-white rounded-lg border p-4 text-center">
          <div class="flex items-center justify-center gap-1 text-lg font-semibold">
            <i class="fa-regular fa-heart text-red"></i>
            <%= @repository.forks_count %>
          </div>
          <p class="text-sm text-slate-600">Forks</p>
        </div>
        <div class="bg-white rounded-lg border p-4 text-center">
          <div class="flex items-center justify-center gap-1 text-lg font-semibold">
            <i class="fa-regular fa-heart text-red"></i>
            <%= @repository.contributors_count %>
          </div>
          <p class="text-sm text-slate-600">Contributors</p>
        </div>
        <div class="bg-white rounded-lg border p-4 text-center">
          <div class="flex items-center justify-center gap-1 text-lg font-semibold">
            <i class="fa-regular fa-heart text-red"></i>
            <%= @repository.open_issues_count %>
          </div>
          <p class="text-sm text-slate-600">Issues</p>
        </div>
        <div class="bg-white rounded-lg border p-4 text-center">
          <div class="flex items-center justify-center gap-1 text-lg font-semibold">
            <i class="fa-regular fa-heart text-red"></i>
            <%= @repository.pull_requests_count %>
          </div>
          <p class="text-sm text-slate-600">Pull Requests</p>
        </div>
        <div class="bg-white rounded-lg border p-4 text-center">
          <div class="flex items-center justify-center gap-1 text-lg font-semibold">
            <i class="fa-regular fa-heart text-red"></i>
            <%= time_ago_in_words(@repository.last_update) %>
          </div>
          <p class="text-sm text-slate-600">Ultimo update</p>
        </div>
      </div>

      <!-- Topics -->
      <div class="flex flex-wrap gap-2 mb-6">
        <% @repository.topics.each do |topic| %>
          <span class="px-2 py-1 text-xs font-medium bg-gray-100 text-gray-800 rounded-md">
            <%= topic %>
          </span>
        <% end %>
      </div>
    </div>

    <!-- Tabs Navigation -->
    <div class="mb-6">
      <nav class="flex space-x-8" aria-label="Tabs">
        <%= link_to repository_path(@repository), 
            class: "whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm #{'border-indigo-500 text-indigo-600' if params[:tab].blank?} #{'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300' unless params[:tab].blank?}" do %>
          Panoramica
        <% end %>
        <%= link_to repository_path(@repository, tab: 'personal'), 
            class: "whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm #{'border-indigo-500 text-indigo-600' if params[:tab] == 'personal'} #{'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300' unless params[:tab] == 'personal'}" do %>
          Note Personali
        <% end %>
        <%= link_to repository_path(@repository, tab: 'activity'), 
            class: "whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm #{'border-indigo-500 text-indigo-600' if params[:tab] == 'activity'} #{'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300' unless params[:tab] == 'activity'}" do %>
          Attivit√†
        <% end %>
      </nav>
    </div>

    <!-- Tab Content -->
    <% if params[:tab].blank? %>
      <!-- Overview Tab -->
      <div class="space-y-6">
        <div class="grid md:grid-cols-2 gap-6">
          <!-- Repository Info -->
          <div class="bg-white rounded-lg border">
            <div class="px-6 py-4 border-b border-gray-200">
              <h3 class="text-lg font-medium text-gray-900">Informazioni Repository</h3>
            </div>
            <div class="px-6 py-4 space-y-4">
              <div class="flex justify-between">
                <span class="text-slate-600">Linguaggio principale:</span>
                <span class="px-2 py-1 text-xs font-medium bg-gray-100 text-gray-800 rounded-md">
                  <%= @repository.primary_language %>
                </span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-600">Licenza:</span>
                <span><%= @repository.license %></span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-600">Ultima release:</span>
                <span><%= @repository.latest_release %></span>
              </div>
              <% if @repository.homepage.present? %>
                <div class="flex justify-between">
                  <span class="text-slate-600">Homepage:</span>
                  <%= link_to @repository.homepage, target: '_blank', class: "text-blue-600 hover:underline flex items-center gap-1" do %>
                    Visita 
                    <i class="fa-regular fa-heart text-red"></i>
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="bg-white rounded-lg border">
            <div class="px-6 py-4 border-b border-gray-200">
              <h3 class="text-lg font-medium text-gray-900">Azioni Rapide</h3>
            </div>
            <div class="px-6 py-4 space-y-3">
              <%= link_to @repository.github_url, target: '_blank', class: "w-full inline-flex items-center justify-start px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-gray-800 hover:bg-gray-700" do %>
                <i class="fa-regular fa-heart text-red"></i>
                Visualizza su GitHub
              <% end %>
              <button class="w-full inline-flex items-center justify-start px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                <i class="fa-regular fa-heart text-red"></i>
                Metti una stella
              </button>
              <button class="w-full inline-flex items-center justify-start px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                <i class="fa-regular fa-heart text-red"></i>
                Fai un fork
              </button>
              <button class="w-full inline-flex items-center justify-start px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                <i class="fa-regular fa-heart text-red"></i>
                Segnala problema
              </button>
            </div>
          </div>
        </div>
      </div>

    <% elsif params[:tab] == 'personal' %>
      <!-- Personal Tab -->
      <div class="space-y-6">
        <!-- Personal Tags -->
        <div class="bg-white rounded-lg border">
          <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900 flex items-center gap-2">
              <i class="fa-regular fa-heart text-red"></i>
              Tag Personali
            </h3>
            <p class="text-sm text-gray-600 mt-1">Organizza i tuoi repository con tag personalizzati</p>
          </div>
          <div class="px-6 py-4 space-y-4">
            <div class="flex flex-wrap gap-2">
              <% @user_tags.each do |tag| %>
                <span class="inline-flex items-center gap-1 px-2 py-1 text-xs font-medium border border-gray-300 rounded-md bg-white text-gray-700">
                  <%= tag.name %>
                  <%= link_to remove_tag_repository_path(@repository, tag_id: tag.id), method: :delete, remote: true, class: "ml-1 text-gray-400 hover:text-gray-600" do %>
                    <i class="fa-regular fa-heart text-red"></i>
                  <% end %>
                </span>
              <% end %>
            </div>
            <%= form_with url: add_tag_repository_path(@repository), method: :post, remote: true, local: false, class: "flex gap-2" do |f| %>
              <%= f.text_field :tag_name, placeholder: "Aggiungi nuovo tag...", class: "flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500" %>
              <%= f.submit "Aggiungi", class: "inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700" %>
            <% end %>
          </div>
        </div>

        <!-- Personal Notes -->
        <div class="bg-white rounded-lg border">
          <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900 flex items-center gap-2">
              <i class="fa-regular fa-heart text-red"></i>
              Note Personali
            </h3>
            <p class="text-sm text-gray-600 mt-1">Le tue note sono visibili solo a te</p>
          </div>
          <div class="px-6 py-4 space-y-4">
            <%= form_with model: [@repository, @user_note], local: false do |f| %>
              <%= f.text_area :content, 
                  placeholder: "Scrivi le tue note su questo repository...", 
                  rows: 6,
                  class: "w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500" %>
              <%= f.submit "Salva Note", class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700" %>
            <% end %>
          </div>
        </div>
      </div>

    <% else %>
      <!-- Activity Tab -->
      <div class="space-y-6">
        <div class="bg-white rounded-lg border">
          <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900">Cronologia Attivit√†</h3>
          </div>
          <div class="px-6 py-4">
            <div class="space-y-4">
              <% @repository.recent_activities.each do |activity| %>
                <div class="flex items-center gap-3 p-3 rounded-lg <%= activity_bg_color(activity.type) %>">
                  <div class="w-2 h-2 rounded-full <%= activity_dot_color(activity.type) %>"></div>
                  <div>
                    <p class="font-medium"><%= activity.title %></p>
                    <p class="text-sm text-slate-600">
                      <%= time_ago_in_words(activity.created_at) %> fa - <%= activity.description %>
                    </p>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<script>
// JavaScript per gestire l'interattivit√† lato client se necessario
document.addEventListener('DOMContentLoaded', function() {
  // Gestione form AJAX
  const forms = document.querySelectorAll('form[data-remote="true"]');
  forms.forEach(form => {
    form.addEventListener('ajax:success', function(event) {
      // Gestisci successo AJAX
      console.log('Form submitted successfully');
    });
  });
});
</script>